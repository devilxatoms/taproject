{% block content  %}
    <section>
        <div class="header-buttons">
        </div>
        <div class="panel-content">
            
<div class="panel panel-default">
            <div class="padding-fixed" id="create-cashbox-module">
                <div class="form-group">
                    <label for="subsidiary">Sucursal</label>
                    <vue-selectize-js
                            v-model="cashbox.subsidiaryId"
                            :selectize-settings="subsidiarySettings"
                            :selectize-options="listSubsidiaries">
                    </vue-selectize-js>
                </div>
                <div class="form-group">
                    <label for="name">Nombre</label>
                    <input id="name" type="text" v-model="cashbox.name">
                </div>
                <!--
                <div class="form-group">
                    <label for="password">Contrase√±a</label>
                    <input id="password" type="text">
                </div>
                <div class="form-group">
                    <label for="password">Responsable</label>
                    <input id="password" type="text">
                </div>
                <div class="form-group">
                    <label for="password">Habilitar cajero</label>
                    <input id="password" type="text">
                </div>
                -->
                <div class="form-group">
                    <label for="password">Moneda</label>
                    <vue-selectize-js
                            v-model="cashbox.currencyId"
                            :selectize-settings="currencySettings"
                            :selectize-options="listCurrencies">
                    </vue-selectize-js>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <button class="btn btn-success" @click="saveCashbox()">
                            <span class="fa fa-floppy-o"></span> Guardar
                        </button>
                    </div>
                </div>
            </div>
            <!-- Modal de notificaion de cambios -->
            <div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="modal-delete-bank-account" id="modal-result">
                <div class="modal-dialog modal-sm" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">
                                <span class="fa fa-check-circle"></span> Exito
                            </h4>
                        </div>
                        <div class="modal-body">
                            Cambios guardados correctamente!
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                            <button type="button" class="btn btn-primary" @click="">Aceptar</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- -->

        </div>
        </div>
        
    </section>

    {% block loadScripts %}
        <script id="scriptContainer" type="text/javascript">
            var listSubsidiaries = {{ subsidiaries | json_encode | raw }};
            var listCurrencies = {{ currencies | json_encode | raw }};

            {% if cashbox %}
            var cashbox = {{ cashbox | json_encode | raw }};
            {% else %}
            var cashbox = null;
            {% endif %}

            (function(cashbox, listSubsidiaries, listCurrencies) {
                var emptyCashbox = { subsidiaryId: '', currencyId: '' };
                var subsidiarySettings = {
                    valueField: 'id',
                    labelField: 'name',
                    searchField: ['name'],
                    maxItems: 1
                };
                var currencySettings = {
                    valueField: 'id',
                    labelField: 'code',
                    searchField: ['code'],
                    maxItems: 1
                };
                var createCashboxModule = new Vue({
                    el: '#create-cashbox-module',
                    data: {
                        cashbox: cashbox != null ? cashbox : _.cloneDeep(emptyCashbox),
                        listSubsidiaries: listSubsidiaries,
                        listCurrencies: listCurrencies,
                        subsidiarySettings: subsidiarySettings,
                        currencySettings: currencySettings
                    },
                    methods: {
                        saveCashbox: function() {
                            if (this.cashbox.id == null) {
                                $.post(
                                    AJAX_PATH + 'punto-de-venta/cajas',
                                    this.cashbox,
                                    function (response) {
                                        this.cashbox = _.cloneDeep(emptyCashbox);
                                        $('#modal-result').modal('show');
                                    }.bind(this)
                                );
                            } else {
                                $.post(
                                    AJAX_PATH + 'punto-de-venta/cajas/' + this.cashbox.id,
                                    this.cashbox,
                                    function (response) {
                                        this.cashbox = _.cloneDeep(emptyCashbox);
                                        $('#modal-result').modal('show');
                                    }.bind(this)
                                );
                            }
                        }
                    },
                    delimiters: ['${', '}']
                })
            })(cashbox, listSubsidiaries, listCurrencies);
        </script>
    {% endblock %}
{% endblock %}
