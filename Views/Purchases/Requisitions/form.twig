{% block content  %}
    <section>
        <div id="formPurchases">
            <div class="header-buttons">
                <div class="btn-group main-buttons">
                    <a @click="saveRequisitionAjax" role="button" class="btn btn-success">
                        <i class="fa fa-floppy-o" aria-hidden="true"></i>
                        Guardar Requisición</a>
                    <a v-if="id" @click="removeRequisition" role="button" class="btn bgRed cWhite purchase_remove">
                        <i class="fa fa-trash" aria-hidden="true"></i>
                        Cancelar Requisición</a>
                </div>
                {# <div class="btn-group secondary-buttons">
                    <a rol="button" class="btn btn-primary cBlue" data-toggle="modal" data-target="#importModal">
                        <i class="fa fa-file-text" aria-hidden="true"></i> Importar Archivos
                    </a>
                </div> #}
            </div>
            <div class="panel-content">
                <div id="headerSelects">
                    <div class="box">
                        <div class="box-header">
                            <h3 class="box-title">Datos de la Requisición</h3>
                            <div class="box-tools pull-right">
                                  <button type="button" class="btn btn-box-tool" data-toggle="collapse" data-target=".collapseFiltro" aria-expanded="false" aria-controls="collapseFiltro" data-toggle="tooltip"  title="Indicaciones">
                                  <i class="ui ui-help_outline"></i>
                                  </button>
                           </div>
                        </div>
                        <div class="indication collapse collapseFiltro">
                            <div class="indication-content">
                                <div class="indication-img">
                                    <span class="indication-icon ui ui-help"></span>
                                </div>
                                <div class="indication-text">
                                    Instrucciones: Añade los datos de la requisición obligatorios (*). El campo Proveedor es opcional
                                </div>
                            </div>
                        </div>
                        <div class="box-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <vue-alert-validator ref="validator"></vue-alert-validator>
                                    </div>
                                </div>
                                <div class="row">
                                    <div v-if="id" class="col-md-2">
                                        <div class="form-group">
                                            <label for="id">Folio</label>
                                            <input type="text" v-model="id" disabled>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="depertment">Departamento</label>
                                            <template>
                                                <el-select v-model="valueDepartment" filterable placeholder="Seleccione o escriba..">
                                                    <el-option
                                                        v-for="item in departments"
                                                        :key="item.id"
                                                        :label="item.name"
                                                        :value="item.id">
                                                    </el-option>
                                                </el-select>
                                            </template>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="created_at">Fecha</label>
                                            <input
                                            id="created_at"
                                            name="created_at"
                                            type="text"
                                            v-model="created_at"
                                            disabled="">
                                        </div>
                                    </div> 
                                </div>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-group req">
                                            <label for="warehouse">Almacén</label>
                                            <el-select v-model="warehouse" filterable placeholder="Seleccione...">
                                                <el-option
                                                v-for="item in warehouses"
                                                :key="item.id"
                                                :label="item.name"
                                                :value="item.id">
                                                </el-option>
                                            </el-select>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="provider">Proveedor</label>
                                            <el-select v-model="provider" filterable placeholder="Seleccione...">
                                                <el-option
                                                v-for="item in providers"
                                                :key="item.id"
                                                :label="item.legal_name"
                                                :value="item.id">
                                                </el-option>
                                            </el-select>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="pull-right">
                                            <div class="form-group req">
                                                <label for="requisition_date">Fecha de requerimiento</label>
                                                <el-date-picker
                                                    v-model="requisition_date"
                                                    format="dd-MM-yyyy"
                                                    type="date"
                                                    :picker-options="pickerOptions"
                                                    placeholder="Seleccionar fecha">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group" >
                                            <label for="specialOrder">Pedido</label>
                                            <input type="checkbox" name="specialOrder" v-model="specialOrder" min="1">
                                        </div>
                                        <div v-if="specialOrder">
                                            <div class="form-group">
                                                <label for="referenceOrder">Referencia</label>
                                                <input name="referenceOrder" v-model="referenceOrder">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                        </div>
                    </div>
                    {# tabla #}
                    <div class="row">
                        <div class="col-md-12">
                            <div class="panel-group"
                                id="accordion"
                                role="tablist"
                                aria-multiselectable="true">
                                <div class="panel panel-default">
                                    <div class="panel-heading" role="tab" id="headingOne">
                                     <div class="box-header">
                                        <h4 class="box-title">
                                            <a role="button"
                                                data-toggle="collapse"
                                                data-parent="#accordion"
                                                href="#productsDetail"
                                                aria-expanded="true"
                                                aria-controls="productsDetail">
                                                Lista de productos
                                                <i class="fa fa-caret-down" aria-hidden="true"></i>
                                            </a>
                                        </h4>
                                            <div class="box-tools pull-right">
                                                <button type="button" class="btn btn-box-tool" data-toggle="collapse" data-target=".collapseOpen" aria-expanded="false" aria-controls="collapseOpen" data-toggle="tooltip"  title="Indicaciones">
                                                <i class="ui ui-help_outline"></i>
                                                </button>
                                            </div>
                                    </div>
                                        <div class="indication collapse collapseOpen">
                                            <div class="indication-content">
                                                <div class="indication-img">
                                                <span class="indication-icon ui ui-help"></span>
                                                </div>
                                                 <div class="indication-text">
                                                 Instrucciones: Agrega en la tabla los productos que deseas solicitar.
                                                 Es necesario por lo menos un producto para poder continuar.
                                                </div>
                                            </div>
                                        </div>  
                                    </div>
                                    <div id="productsDetail"
                                        class="panel-collapse collapse in"
                                        role="tabpanel"
                                        aria-labelledby="headingOne">
                                        <div class="panel-body">
                                            <!-- Tabla detalle de productos -->
                                            <div class="row">
                                                <div class="col-md-4">
                                                    {% if create %}
                                                    <div class="alert alert-info alert-dismissible" role="alert">
                                                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                                        <strong>Seleccione los productos</strong> que desea <strong>agregar a la compra</strong> y haga click en <strong>Crear
                                                        Compra.</strong>
                                                    </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <vue-products-table-david
                                                        :barcode-options="barcodeOptions"
                                                        :code-options="codeOptions"
                                                        :name-options="nameOptions"
                                                        :rows="rows"
                                                        :taxes="taxes"
                                                        :disable-discount="true"
                                                        :disable-tax="true"
                                                        :disable-total="true"
                                                        :disable-add="true"
                                                        :on-delete="removeDetail">
                                                    </vue-products-table-david>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-8">
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div class="col-md-4">
                                                                <div class="form-group">
                                                                    <label for="requisition_comment">Comentario:</label>
                                                                    <textarea  rows="3" v-model="comment" placeholder="Comentarios" ></textarea>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="pull-right">
                                                        <vue-products-table-totals
                                                            ref="tabletotals"
                                                            :rows="rows"
                                                            :disable-discount="true"
                                                            :disable-tax="true"
                                                            :disable-total="true">
                                                        </vue-products-table-totals>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {# end tabla #}

                {% if edit %}
                    <vue-comments :create="true" :picture="false" :comments="comments" :on-send="sendComment"></vue-comments>
                {% endif %}
            </div>
        
            <div id="importModal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"  aria-labelledby="myLargeModalLabel" data-backdrop="false">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="gridSystemModalLabel">Documentos</h4>
                        </div>
                        <div class="modal-body">
                            {% if edit %}
                            <h3>Documentos guardados</h3>
                            <div class="table-responsive">
                                <div v-if="files.length <= 0">
                                    <strong>Sin documentos</strong>
                                </div>
                                <table v-else class="table table-bordered table-stripped">
                                    <thead>
                                        <th>Archivo</th>
                                        <th>Nombre</th>
                                        <th>Acciones</th>
                                    </thead>
                                    <tbody>
                                        <tr v-for="file in files">
                                            <td>.${ file.extension }</td>
                                            <td>${ file.name }</td>
                                            <td>
                                                <button v-on:click="downloadFile(file.id)" class="btn btn-success"><i class="fa fa-download" aria-hidden="true"></i></button>
                                                <button v-on:click="deleteFile(file)" class="btn btn-danger"><i class="fa fa-trash-o" aria-hidden="true"></i></button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            {% endif %}
                            <h3>Importar documentos</h3>
                            <p>Seleccione los documentos para importar.</p>
                            <p><i>Al <strong>guardar la requisición</strong> se importarán los archivos nuevos.</i></p>
                            <label>Seleccione los archivos:</label>
                            <input id="files" type="file" name="files" accept=".xml, .doc, .docx, .xls, .xlsx, .xml, .pdf, .jpeg, .png" multiple>
                            <br>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}
{% block loadScripts %}
    <script id="scriptContainer" type="text/javascript">
        init.length = 0;
        uiVars['id'] = {{ id|json_encode|raw }};
        init = [{
            title: (uiVars['id']) ? 'Editar Requisición ' + uiVars['id'] : 'Nueva Requisición',
            file: 'Purchase/Requisitions/form.js',
            functions: [ {
                name: 'initFormRequisition',
                args: [uiVars['id']]
            } ]
        } ];
    </script>
{% endblock %}
