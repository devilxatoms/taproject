{% block content %}
<section>
    <div ref="formPurchases" id="formPurchases">
        <div class="header-buttons">
            <div class="btn-group main-buttons">
                <a v-if="!viewMode" role="button" @click="savePurchaseAjax" class="purchase_submit btn btn-success">
                        <i class="fa fa-floppy-o" aria-hidden="true"></i>
                        Guardar Compra</a>
                <a v-if="id" @click="removePurchase" role="button" class="btn bgRed cWhite purchase_remove">
                        <i class="fa fa-trash" aria-hidden="true"></i>
                            Cancelar Compra</a>
            </div>
            {#
            <div class="btn-group secondary-buttons">
                <a rol="button" class="btn btn-primary cBlue" data-toggle="modal" data-target="#importModal">
                        <i class="fa fa-file-text" aria-hidden="true"></i> Importar Archivos
                    </a>
            </div> #}
        </div>
        <div class="panel-content">
            <div class="box">
                <div class="row">
                    <div class="col-md-4">
                        <vue-alert-validator ref="validator"></vue-alert-validator>
                    </div>
                </div>
                <div class="box-header">
                    <h3 class="box-title">Datos de la Compra</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-toggle="collapse" data-target=".collapseUp" aria-expanded="false" aria-controls="collapseUp"
                            data-toggle="tooltip" title="Indicaciones">
                                <i class="ui ui-help_outline"></i>
                            </button>
                    </div>
                </div>
                <div class="indication collapse collapseUp">
                    <div class="indication-content">
                        <div class="indication-img">
                            <span class="indication-icon ui ui-help"></span>
                        </div>
                        <div class="indication-text">
                            Instrucciones: Añade los datos de la compra obligatorios (*). Se debe asignar proveedor para enviar la orden de compra.
                        </div>
                    </div>
                </div>
                <div class="box-body">
                    <div id="headerSelects">
                        <div class="row">
                            <div v-if="id" class="col-md-3">
                                <div class="form-group">
                                    <label for="id">Folio</label>
                                    <input v-model="id" type="text" value="" disabled="">
                                </div>
                            </div>
                            <div v-if="purchase_requisition_id" class="col-md-2">
                                <el-button class="block" type="default" size="small" @click="openRequisition()"><i class="fa fa-file-text-o" aria-hidden="true"></i> Ver Requisición de Compra</el-button>
                            </div>
                            <div v-if="purchase_order_id" class="col-md-2">
                                <el-button class="block" type="default" size="small" @click="openOrder()"><i class="fa fa-file-text-o" aria-hidden="true"></i> Ver Orden de Compra</el-button>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label for="created_at">Fecha</label>
                                    <input v-model="created_at" type="text" disabled>
                                </div>
                            </div>
                            <div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label for="spendingType">Tipo de gasto</label>
                                        <el-select clearable v-model="expenseValue" placeholder="Seleccione gasto...">
                                            <el-option v-for="item in expenses" :key="item.id" :label="item.name" :value="item.id">
                                            </el-option>
                                        </el-select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group req">
                                    <label for="warehouse">Almacén</label>
                                    <el-select v-model="warehouse" filterable placeholder="Seleccione...">
                                        <el-option v-for="item in warehouses" :key="item.id" :label="item.name" :value="item.id">
                                        </el-option>
                                    </el-select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group req">
                                    <label for="provider">Proveedor</label>
                                    <el-select v-model="provider" filterable placeholder="Seleccione...">
                                        <el-option v-for="item in providers" :key="item.id" :label="item.legal_name" :value="item.id">
                                        </el-option>
                                    </el-select>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label for="bill_id">Factura</label>
                                    <input v-model="folio" type="text">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="pull-right">
                                    <div class="form-group req">
                                        <label for="purchase_date">Fecha de compra</label>
                                        <el-date-picker v-model="purchase_date" format="dd-MM-yyyy" type="date">
                                        </el-date-picker>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-2">
                                <div class="form-group">
                                    <input type="checkbox" name="earlyPayment" v-model="earlyPayment" min="1">
                                    Descuento pronto pago
                                </div>
                            </div>
                            <div v-if="earlyPayment">
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <label for="earlyPaymentValue">Cantidad %</label>
                                        <el-input-number v-model="earlyPaymentValue" :min="1"></el-input-number>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <label for="earlyPaymentDays">Cant. dias limite</label>
                                        <el-input-number v-model="earlyPaymentDays" :min="1"></el-input-number>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="box">
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel-group" id="productsPanel" role="tablist" aria-multiselectable="true">
                            <div class="box-header" role="tab" id="headingOne">
                                <h4 class="box-title">
                                    <a role="button" data-toggle="collapse" data-parent="#productsPanel" href="#productsTablePurchases" aria-expanded="true"
                                        aria-controls="productsTablePurchases">
                                    Lista de productos <i class="fa fa-caret-down" aria-hidden="true"></i>
                                        </a>
                                </h4>
                            </div>
                            <div class="indication collapse collapseOpened">
                                <div class="indication-content">
                                    <div class="indication-img">
                                        <span class="indication-icon ui ui-help"></span>
                                    </div>
                                    <div class="indication-text">
                                        Instrucciones: Agrega en la tabla los productos que deseas solicitar o realiza cambios a productos existentes.
                                    </div>
                                </div>
                            </div>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-toggle="collapse" data-target=".collapseOpened" aria-expanded="false"
                                    aria-controls="collapseOpened" data-toggle="tooltip" title="Indicaciones">
                                    <i class="ui ui-help_outline"></i>
                                    </button>
                            </div>

                            <div id="productsTablePurchases" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <vue-products-table-david :view-mode="viewMode" v-bind:barcode-options="barcodeOptions" v-bind:code-options="codeOptions"
                                                v-bind:name-options="nameOptions" v-bind:rows="rows" v-bind:taxes="taxes" v-bind:disable-add="true"
                                                v-bind:disable-add-row="disableAddRow" v-bind:early-payment="earlyPayment" v-bind:early-payment-value="earlyPaymentValue"
                                                v-bind:on-delete="removeDetail">
                                            </vue-products-table-david>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <br>
                                        <div class="col-md-8">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="purchase_comment">Comentario:</label>
                                                        <textarea v-model="comment" placeholder="Comentarios"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="pull-right">
                                                <vue-products-table-totals ref="tabletotals" v-bind:rows="rows" v-bind:early-payment="earlyPayment" v-bind:early-payment-value="earlyPaymentValue">
                                                </vue-products-table-totals>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="box">
                <div class="row" v-if="!id">
                    <div class="col-md-12">
                        <div class="box-header">
                            <h3 class="box-title">Detalles de Pago</h3>
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-toggle="collapse" data-target=".collapseFilt" aria-expanded="false" aria-controls="collapseFilt"
                                    data-toggle="tooltip" title="Indicaciones">
                                <i class="ui ui-help_outline"></i>
                                </button>
                            </div>
                        </div>
                        <div class="indication collapse collapseFilt">
                            <div class="indication-content">
                                <div class="indication-img">
                                    <span class="indication-icon ui ui-help"></span>
                                </div>
                                <div class="indication-text">
                                    Instrucciones: Agrega en la tabla los productos que deseas solicitar o realiza cambios a productos existentes.
                                </div>
                            </div>
                        </div>
                        <div class="box-body">
                            <div class="form-group">
                                <input type="checkbox" v-model="applyPayment"> Aplicar Pago
                            </div>
                            <div v-if="showPayment">
                                {% include 'Payment/fields.twig' %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div v-if="!id" class="box">
                <div class="box-header with-border">
                    <h3 class="box-title">Requisición de Envio</h3>
                </div>
                <div class="box-body">
                    <div class="row">
                        <div class="col-md-12">
                            <vue-ship-requisition ref="componentShipReq" :data-ship="dataShip" called-from="compras" type="edit">
                            </vue-ship-requisition>
                        </div>
                    </div>

                </div>
            </div>
        </div>
</section>
{% endblock %} {% block loadScripts %}
<script id="scriptContainer" type="text/javascript">
    init.length = 0;
    uiVars['id'] = {{ id | json_encode | raw }};
    init = [{
        title: (uiVars['id']) ? 'Ver Compra ' + uiVars['id'] : 'Nueva Compra',
        file: 'Purchase/Purchases/form.js',
        functions: [{
            name: 'initFormPurchase',
            args: [uiVars['id']]
        }]
    }];
</script>
{% endblock %}